# 개별과제 - 음악회 표예매(예술의 전당) 시스템
# SAC

  
# 서비스 시나리오

예술의 전당, 음악회 표 예매 Portal

기능적 요구사항
1.공연자(예술의전당)가 공연을 등록한다.
2.고객이 공연 표를 예매한다.
3.고객이 공연 표를 취소할 수 있다.
4.공연자가 공연을 취소한다.
5.공연자가 공연을 취소하면, 공연 표 예매를 취소한다.
6.공연 표가 예매되거나 취소되면 참가인원수를 변경한다.
7.고객이 표 예매 상황을 조회한다.

비기능적 요구사항
1. 장애격리
    1. 강의 관리 기능이 수행되지 않더라도 수강신청은 365일 24시간 받을 수 있어야 한다  Async (event-driven), Eventual Consistency


# 분석/설계

## Event Storming 결과
* MSAEz 로 모델링한 이벤트스토밍 결과:  http://msaez.io/#/storming/25xfhEqq7JS3ZlYEB44C4PN3dkT2/mine/d2a91ae4e123bd34d3b2fdd608ec8939/-M5VP2nfhFJ2OWxUwTE1


### 조직 및 요구사항 도출 
조직: 고객, 공연사(예술의전당)

기능적 요구사항
1.공연자가 공연을 등록한다.
2.고객이 공연 표를 예매한다.
3.고객이 공연 표를 취소할 수 있다.
4.공연자가 공연을 취소한다.
5.공연자가 공연을 취소하면, 공연 표 예매를 취소한다.
6.공연 표가 예매되거나 취소되면 참가인원수를 변경한다.
7.고객이 표 예매 상황을 조회한다.

비기능적 요구사항
1. 장애격리
    1. 강의 관리 기능이 수행되지 않더라도 수강신청은 365일 24시간 받을 수 있어야 한다  Async (event-driven), Eventual Consistency



### 이벤트도출, 액터 커맨드 부착, 어그리게잇, 바운디드 컨텍스트로 묶기
![image](https://user-images.githubusercontent.com/48303857/79729452-74d1e800-832a-11ea-9b08-0d2807c69a28.jpeg)

    - 도메인 서열 분리 
        - Core Domain:  표예매(front), 공연관리 : 핵심 서비스이며, 연간 Up-time SLA 수준을 99.999% 목표, 배포주기는 표예매의 경우 1주일 1회 미만, 공연관리의 경우 1개월 1회 미만
        - Supporting Domain:   Dashboard : 경쟁력을 내기위한 서비스이며, SLA 수준은 연간 60% 이상 uptime 목표, 배포주기는 각 팀의 자율이나 표준 스프린트 주기가 1주일 이므로 1주일 1회 이상을 기준으로 함.
         

### 폴리시 도출

### 폴리시와 컨텍스트 매핑 (Pub/Sub)

### 기능적/비기능적 요구사항을 커버하는지 검증

    - 공연자가 공연을 등록한다. (ok)
    - 고객이 공연 표를 예매한다.  (ok)
    - 고객이 공연 표를 취소할 수 있다.  (ok)
    - 공연자가 공연을 취소한다.  (ok)
    - 공연자가 공연을 취소하면, 공연 표 예매 시스템에 전달된다.  (ok - event driven)
    - 공연 표가 예매되거나 취소되면 공연 참가인원수를 변경한다. (ok - event driven)
    - 고객이 표 예매 상황을 조회한다.(view)

### 요구사항을 커버하도록 모델링됨

    - 공연 관리 기능은 서비스 제공의 측면이 강하며, 한 번 등록 시 여러명의 고객이 표 예매를 하기 때문에 표예매(Front)에 대해 공연관리 서비스는 Async (event-driven), Eventual Consistency 방식으로 처리한다.
    - 학생이 강의관리에서 확인할 수 있는 수강신청내용을 수강신청시스템(프론트엔드)에서 확인할 수 있어야 한다 CQRS
    - 결제를 제외한 나머지 inter-microservice 트랜잭션: 모든 이벤트에 대해 데이터 일관성의 시점이 크리티컬하지 않은 모든 경우가 대부분이라 판단, Eventual Consistency 를 기본으로 채택함.    


## 헥사고날 아키텍처 
    
    - Chris Richardson, MSA Patterns 참고하여 Inbound adaptor와 Outbound adaptor를 구분함
    - 호출관계에서 PubSub 구현함
    - 서브 도메인과 바운디드 컨텍스트의 분리:  각 팀의 KPI 별로 아래와 같이 관심 구현 스토리를 나눠가짐




# 운영

## CI/CD 설정


각 구현체들은 각자의 source repository 에 구성되었고, 사용한 CI/CD 플랫폼은 Azure를 사용하였으며, pipeline build script 는 각 프로젝트 폴더 이하에 azure-pipeline.yml 에 포함되었다.

- devops를 활용하여 pipeline을 구성하였고, CI CD 자동화를 구현하였다.

- pod 가 정상적으로 올라간 것을 확인하였다.

- 쿠버네티스에 모두 서비스로 등록된 것을 확인할 수 있다.
![image]()









